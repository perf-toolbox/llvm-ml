load("@bazel_skylib//rules:expand_template.bzl", "expand_template")
load("@llvm-project//llvm:lit_test.bzl", "lit_test", "package_path")
load("//bazel/testing:paths.bzl", "resolve_path")
load("//bazel/testing:lit.bzl", "glob_lit_tests")

expand_template(
    name = "llvm_ml_lit_site_cfg",
    testonly = True,
    out = "lit.site.cfg",
    substitutions = {
        "@LIT_SITE_CFG_IN_HEADER@": "# Autogenerated, do not edit.",
        "@LLVM_LIT_TOOLS_DIR@": package_path("@llvm-project//llvm/utils/lit:BUILD"),
        "@LLVM_SOURCE_DIR@": package_path("@llvm-project//llvm:BUILD"),
        "@LLVM_BINARY_DIR@": package_path("@llvm-project//llvm:BUILD"),
        "@LLVM_TOOLS_DIR@": package_path("@llvm-project//llvm:BUILD"),
        "@LLVM_ML_SOURCE_DIR@": resolve_path("//:BUILD"),
        "@LLVM_ML_TOOLS_DIR@": resolve_path("//tools:BUILD"),
        "@LLVM_ML_UTILS_DIR@": resolve_path("//utils:BUILD"),
    },
    template = "lit.site.cfg.in",
)

glob_lit_tests(
    data = [
        "//utils:mc-harness-dump",
        "//utils:mc-data-gen",
        "//tools:llvm-mc-dataset",
        "@llvm-project//llvm:FileCheck",
        "@llvm-project//llvm:count",
        "@llvm-project//llvm:not",
        "lit.cfg.py",
    ],
    driver = "lit.site.cfg",
    test_file_exts = ["s", "tst"],
)

